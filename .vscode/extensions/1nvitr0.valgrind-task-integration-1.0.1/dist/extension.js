(()=>{"use strict";var t={738:function(t,i,e){var n=this&&this.__awaiter||function(t,i,e,n){return new(e||(e=Promise))((function(r,s){function a(t){try{d(n.next(t))}catch(t){s(t)}}function o(t){try{d(n.throw(t))}catch(t){s(t)}}function d(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(a,o)}d((n=n.apply(t,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.ValgrindCommandProvider=void 0;const r=e(496),s=e(328);i.ValgrindCommandProvider=class{constructor(t){this.taskProvider=t}valgrindPid(t,i){return n(this,void 0,void 0,(function*(){const t=yield this.getValgrindTask(i);if(t)return r.tasks.executeTask(t),yield this.taskProvider.getPid(t.definition.target)}))}valgrindGdbArg(t,i){return n(this,void 0,void 0,(function*(){const t=yield this.valgrindPid();if(t)return`target remote | vgdb --pid=${t}`}))}getValgrindTask(t){var i;return n(this,void 0,void 0,(function*(){const e=yield r.tasks.fetchTasks({type:s.ValgrindTaskType.debugTask});return t||(t=1===e.length?e[0].definition.target:null===(i=yield r.window.showQuickPick(e.map((t=>({label:t.definition.target})))))||void 0===i?void 0:i.label),e.find((i=>i.definition.target==t))}))}}},200:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0});const n=e(496),r=e(738);i.default=function(t){const i=new r.ValgrindCommandProvider(t);return[n.commands.registerCommand("valgrind-task-integration.valgrindPid",i.valgrindPid.bind(i)),n.commands.registerCommand("valgrind-task-integration.valgrindGdbArg",i.valgrindGdbArg.bind(i))]}},781:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0});const n=e(496);i.default=function(t,i){return[n.tasks.registerTaskProvider(t.taskType,t),n.tasks.registerTaskProvider(i.taskType,i)]}},328:function(t,i,e){var n=this&&this.__awaiter||function(t,i,e,n){return new(e||(e=Promise))((function(r,s){function a(t){try{d(n.next(t))}catch(t){s(t)}}function o(t){try{d(n.throw(t))}catch(t){s(t)}}function d(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(a,o)}d((n=n.apply(t,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.AbstractValgrindTaskProvider=i.ValgrindTaskType=void 0;const r=e(496);var s;(s=i.ValgrindTaskType||(i.ValgrindTaskType={})).task="valgrind",s.debugTask="valgrind-debug",i.AbstractValgrindTaskProvider=class{provideTasks(t){return this.getTasks()}resolveTask(t,i){const{definition:e,name:n}=t;if(e.target&&e.type===this.taskType)return this.getTask(e.target,e.type,n,e)}getTasks(){return n(this,void 0,void 0,(function*(){if(this.tasks)return this.tasks;this.tasks=[];for(const t of Object.keys(this.targets))this.targets[t],this.tasks.push(yield this.getTask(this.targets[t],this.taskType,t));return this.tasks}))}getTask(t,i,e,s){return n(this,void 0,void 0,(function*(){return s||(s={type:i,target:t}),new r.Task(s,r.TaskScope.Workspace,e||`${i}: ${s.target}`,i,this.getTaskExecution(s.target),`$${this.taskType}`)}))}}},898:function(t,i,e){var n=this&&this.__awaiter||function(t,i,e,n){return new(e||(e=Promise))((function(r,s){function a(t){try{d(n.next(t))}catch(t){s(t)}}function o(t){try{d(n.throw(t))}catch(t){s(t)}}function d(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(a,o)}d((n=n.apply(t,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.ValgrindDebugTaskProvider=void 0;const r=e(496),s=e(328),a=e(185);class o extends s.AbstractValgrindTaskProvider{constructor(){super(...arguments),this.taskType=s.ValgrindTaskType.debugTask,this.targets={"valgrind-debug":"${command:cmake.launchTargetPath}"},this.valgrindPids={},this.pidListeners={}}getPid(t){return n(this,void 0,void 0,(function*(){return new Promise((i=>{if(t in this.valgrindPids)i(this.valgrindPids[t]);else{const e=n=>{const r=this.pidListeners[t].indexOf(e);r>=0&&this.pidListeners[t].splice(r,1),i(n)};this.pidListeners[t]||(this.pidListeners[t]=[]),this.pidListeners[t].push(e)}}))}))}getTaskExecution(t){return new r.CustomExecution((i=>n(this,void 0,void 0,(function*(){const e=/\$\{command:([^\}]+)\}/.exec(i.target);return e&&e[1]&&(i.target=(yield r.commands.executeCommand(e[1]))||i.target),new a.ValgrindTaskTerminal(i,this.resolvePid.bind(this,t))}))))}resolvePid(t,i){for(const e of this.pidListeners[t]||[])e(i)}}i.ValgrindDebugTaskProvider=o},600:function(t,i,e){var n=this&&this.__awaiter||function(t,i,e,n){return new(e||(e=Promise))((function(r,s){function a(t){try{d(n.next(t))}catch(t){s(t)}}function o(t){try{d(n.throw(t))}catch(t){s(t)}}function d(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(a,o)}d((n=n.apply(t,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.ValgrindTaskProvider=void 0;const r=e(496),s=e(328),a=e(185);class o extends s.AbstractValgrindTaskProvider{constructor(){super(...arguments),this.taskType=s.ValgrindTaskType.task,this.targets={valgrind:"${command:cmake.launchTargetPath}"}}getTaskExecution(){return new r.CustomExecution((t=>n(this,void 0,void 0,(function*(){return new a.ValgrindTaskTerminal(t)}))))}}i.ValgrindTaskProvider=o},185:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ValgrindTaskTerminal=void 0;const n=e(81),r=e(496),s=e(328);i.ValgrindTaskTerminal=class{constructor(t,i){this.definition=t,this.onPid=i,this.writeEmitter=new r.EventEmitter,this.closeEmitter=new r.EventEmitter,this.onDidWrite=this.writeEmitter.event,this.onDidClose=this.closeEmitter.event,this.taskType=t.type,this.target=t.target}get valgrindArgs(){const t=["--fullpath-after="];return this.definition.valgrind&&t.push(...this.definition.valgrind.args),this.taskType===s.ValgrindTaskType.debugTask&&t.push("--vgdb-error=0"),t}open(t){var i,e;this.writeEmitter.fire("Starting valgrind...\r\n"),this.valgrind=(0,n.spawn)("valgrind",[...this.valgrindArgs,this.target]),null===(i=this.valgrind.stdout)||void 0===i||i.on("data",this.forwardOutput.bind(this)),null===(e=this.valgrind.stderr)||void 0===e||e.on("data",this.forwardOutput.bind(this)),this.valgrind.on("exit",(()=>this.closeEmitter.fire(0))),this.onPid&&this.catchPid().then(this.onPid)}close(){var t,i;null===(t=this.valgrind)||void 0===t||t.kill(),null===(i=this.pidListener)||void 0===i||i.dispose()}catchPid(){return new Promise((t=>{this.pidListener=this.onDidWrite((i=>{var e;const n=/^==(\d+)==/.exec(i);n&&n[1]&&(t(n[1]),null===(e=this.pidListener)||void 0===e||e.dispose())}))}))}forwardOutput(t){t.toString().split(/\r?\n/).forEach((t=>this.writeEmitter.fire(`${t}\r\n`)))}}},496:t=>{t.exports=require("vscode")},81:t=>{t.exports=require("child_process")}},i={};function e(n){var r=i[n];if(void 0!==r)return r.exports;var s=i[n]={exports:{}};return t[n].call(s.exports,s,s.exports,e),s.exports}var n={};(()=>{var t=n;Object.defineProperty(t,"__esModule",{value:!0}),t.activate=void 0;const i=e(200),r=e(781),s=e(600),a=e(898);t.activate=function(t){const e=new s.ValgrindTaskProvider,n=new a.ValgrindDebugTaskProvider;t.subscriptions.push(...(0,r.default)(e,n),...(0,i.default)(n))}})(),module.exports=n})();